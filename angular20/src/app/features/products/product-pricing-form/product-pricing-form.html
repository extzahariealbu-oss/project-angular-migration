<!-- Pricing Tab Content -->

<form #pricingForm="ngForm">
  <div class="pricing-grid">
    <!-- Direct Cost (Buy Price) - Evidence: price.html:300 -->
    <mat-form-field appearance="outline">
      <mat-label>Direct Cost (Buy Price)</mat-label>
      <input matInput 
             type="number" 
             [(ngModel)]="product.directCost"
             name="directCost"
             min="0"
             step="0.01" />
      <span matPrefix>$&nbsp;</span>
    </mat-form-field>

    <!-- Sell Price (excl. tax) -->
    <mat-form-field appearance="outline">
      <mat-label>Sell Price (excl. tax) *</mat-label>
      <input matInput 
             type="number" 
             [(ngModel)]="product.prices!.pu_ht"
             name="sellPrice"
             min="0"
             step="0.01"
             required />
      <span matPrefix>$&nbsp;</span>
      <mat-error>Sell price is required</mat-error>
    </mat-form-field>

    <!-- Tax Rate - Evidence: price.html:91 - Uses product.taxes[0].taxeId._id -->
    <mat-form-field appearance="outline">
      <mat-label>Tax Rate (%)</mat-label>
      <mat-select [(ngModel)]="taxRateId" (ngModelChange)="onTaxRateChange($event)" name="taxRate">
        <mat-option [value]="null">No Tax</mat-option>
        <mat-option *ngFor="let tax of taxes()" [value]="tax._id">
          {{ tax.name }} ({{ tax.rate }}%)
        </mat-option>
      </mat-select>
      <mat-hint *ngIf="getCurrentTaxRate() > 0">Current: {{ getCurrentTaxRate() }}%</mat-hint>
    </mat-form-field>

    <!-- Calculated Price with Tax -->
    <mat-form-field appearance="outline" floatLabel="always">
      <mat-label>Sell Price (incl. tax)</mat-label>
      <input matInput 
             type="text" 
             [value]="calculatePriceWithTax() | number:'1.2-2'"
             readonly />
      <span matPrefix>$&nbsp;</span>
    </mat-form-field>

    <!-- Margin - Evidence: price.html:262-268 -->
    <mat-form-field appearance="outline" *ngIf="product.directCost && product.prices?.pu_ht">
      <mat-label>Margin</mat-label>
      <input matInput 
             type="text" 
             [value]="calculateMargin() | number:'1.2-2'"
             readonly />
      <span matSuffix>%</span>
      <mat-hint>{{ calculateMarginAmount() | number:'1.2-2' }} $</mat-hint>
    </mat-form-field>
  </div>

  <!-- Quantity-based Pricing -->
  <div class="quantity-pricing-section">
    <h4>Quantity-Based Pricing</h4>
    <p class="section-description">Define prices for different quantity levels</p>
  </div>

  <div class="quantity-pricing-table" *ngIf="product.prices?.pricesQty">
    <table mat-table [dataSource]="getQuantityPrices()" class="mat-elevation-z2">
      <!-- Quantity Column -->
      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef>Quantity From</th>
        <td mat-cell *matCellDef="let element">{{ element.key }}</td>
      </ng-container>

      <!-- Price Column -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Price (excl. tax)</th>
        <td mat-cell *matCellDef="let element">
          <mat-form-field appearance="outline" class="compact-field">
            <input matInput 
                   type="number" 
                   [(ngModel)]="product.prices!.pricesQty![element.key]"
                   [name]="'qty_' + element.key"
                   min="0"
                   step="0.01" />
            <span matPrefix>$&nbsp;</span>
          </mat-form-field>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['quantity', 'price']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['quantity', 'price']"></tr>
    </table>
  </div>
</form>
